<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">

  <title>Identifikasi Kura-Kura Bengkulu | Klasfikasi</title>

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="static/plugins/fontawesome-free/css/all.min.css">
  <!-- IonIcons -->
  <link rel="stylesheet" href="http://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="static/dist/css/adminlte.min.css">
  <!-- Google Font: Source Sans Pro -->
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
  <style>
    .box {
        border: 1px solid black;
        margin: 25px 0px;
    }
    .title {
        text-align: center;
        background-color: aqua;
    }
    .content {
        padding: 25px;
    }
    body {
        /* background-color: chartreuse; */
    }
    #output {
        margin-top: 25px;
    }
    .no-js #loader { display: none;  }
    .js #loader { display: block; position: absolute; left: 100px; top: 0; }
    .se-pre-con {
        position: fixed;
        left: 0px;
        top: 0px;
        width: 100%;
        height: 100%;
        z-index: 9999;
        background: url(/static/loading.svg?1) center no-repeat #80808080;
    }
    .content-wrapper {
        background-image: url(/static/images/wallpaper.jpg?1);
    }
</style>
</head>
<!--
BODY TAG OPTIONS:
=================
Apply one or more of the following classes to to the body tag
to get the desired effect
|---------------------------------------------------------|
|LAYOUT OPTIONS | sidebar-collapse                        |
|               | sidebar-mini                            |
|---------------------------------------------------------|
-->
<body class="hold-transition sidebar-mini">
<div class="se-pre-con"></div>
<div class="wrapper">
  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <!-- Left navbar links -->
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" data-widget="pushmenu" href="#"><i class="fas fa-bars"></i></a>
      </li>
    </ul>
  </nav>
  <!-- /.navbar -->

  <!-- Main Sidebar Container -->
  <aside class="main-sidebar sidebar-dark-primary elevation-4">
    <!-- Brand Logo -->
    <a href="/" class="brand-link">
      <img src="static/images/turtle.png" alt="AdminLTE Logo" class="brand-image img-circle elevation-3"
           style="opacity: .8">
      <span class="brand-text font-weight-light">Turtle</span>
    </a>

    <!-- Sidebar -->
    <div class="sidebar">

      <!-- Sidebar Menu -->
      <nav class="mt-2">
        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
          <!-- Add icons to the links using the .nav-icon class
               with font-awesome or any other icon font library -->
            <!-- <li class="nav-item">
                <a href="/" class="nav-link">
                    <i class="nav-icon fas fa-tachometer-alt"></i>
                    <p>
                    Dashboard
                    </p>
                </a>
            </li> -->
            <li class="nav-item">
                <a href="/" class="nav-link active">
                    <i class="nav-icon fas fa-eye"></i>
                    <p>
                    Identifikasi Citra
                    </p>
                </a>
            </li>
            <li class="nav-item has-treeview menu">
                <a href="#" class="nav-link">
                    <i class="nav-icon fas fa-info"></i>
                    <p>
                    Info Kura-Kura
                    <i class="right fas fa-angle-left"></i>
                    </p>
                </a>
                <ul class="nav nav-treeview">
                    <li class="nav-item">
                        <a href="/info?index=0" class="nav-link">
                            <i class="far fa-circle nav-icon"></i>
                            <p>Kura-Kura Nanas</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/info?index=1" class="nav-link">
                            <i class="far fa-circle nav-icon"></i>
                            <p>Kura-Kura Garis Hitam</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/info?index=2" class="nav-link">
                            <i class="far fa-circle nav-icon"></i>
                            <p>Kura-Kura Batok</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/info?index=3" class="nav-link">
                            <i class="far fa-circle nav-icon"></i>
                            <p>Kura-Kura Tempurung Datar</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/info?index=4" class="nav-link">
                            <i class="far fa-circle nav-icon"></i>
                            <p>Kura-Kura Baning Coklat</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/info?index=5" class="nav-link">
                            <i class="far fa-circle nav-icon"></i>
                            <p>Kura-Kura Pipi Putih</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/info?index=6" class="nav-link">
                            <i class="far fa-circle nav-icon"></i>
                            <p>Kura-Kura Biuku</p>
                        </a>
                    </li>
                </ul>
            </li>
        
        </ul>
      </nav>
      <!-- /.sidebar-menu -->
    </div>
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <div class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <div class="row">
                <img style="max-height: 50px" src="static/images/logo.jpeg" alt="Tutle">
                <h1 class="m-0 text-dark" style="padding-top: 8px; margin-left: 10px !important">Identifikasi Kura-Kura Bengkulu</h1>
              </div>
          </div><!-- /.col -->
          <div class="col-sm-6">
            <ol class="breadcrumb float-sm-right">
              <li class="breadcrumb-item"><a href="#">Home</a></li>
              <li class="breadcrumb-item active">Identifikasi Citra</li>
            </ol>
          </div><!-- /.col -->
        </div><!-- /.row -->
      </div><!-- /.container-fluid -->
    </div>
    <!-- /.content-header -->

    <!-- Main content -->
    <div class="content">
        <div class="container-fluid">
        
            <input type="text" value="{{ image_features }}" id="image-features" hidden>

            <div class="card output">
                <div class="card-header">
                    <div class="d-flex justify-content-between">
                        <h3 class="card-title">Hasil Preprocessing</h3>
                    </div>
                </div>
                <div class="card-body">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Segmentation</th>
                                <th>Gray Level Co-Occurrence Matrix</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <img id="clean" src="#" alt="Clean" style="max-height: 200px">
                                </td>
                                <td>
                                    <img id="glcm" src="#" alt="GLCM" style="max-height: 200px">
                                </td>
                            </tr>
                            <tr>
                                <td></td>
                                <td>
                                    <table class="table  table-bordered table-striped">
                                        <thead>
                                            <tr>
                                                <th>Feature</th>
                                                <th>Value</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Contrast</td>
                                                <td id="contrast"></td>
                                            </tr>
                                            <tr>
                                                <td>Correlation</td>
                                                <td id="correlation"></td>
                                            </tr>
                                            <tr>
                                                <td>Energy</td>
                                                <td id="energy"></td>
                                            </tr>
                                            <tr>
                                                <td>Homogeneity</td>
                                                <td id="homogeneity"></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card output">
                <div class="card-header">
                    <div class="d-flex justify-content-between">
                        <h3 class="card-title">Hasil Identifikasi</h3>
                    </div>
                </div>
                <div class="card-body">
                    <table class="table table-bordered table-striped">
                        <thead>
                            <tr>
                                <th colspan="3">Hasil Identifikasi</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td rowspan="11">
                                    <img id="source" src="#" alt="image" style="max-width: 300px">
                                </td>
                                <td>Nama</td>
                                <td id="name"></td>
                            </tr>
                            <tr>
                                <td>Kingdom</td>
                                <td id="kingdom"></td>
                            </tr>
                            <tr>
                                <td>Filum</td>
                                <td id="filum"></td>
                            </tr>
                            <tr>
                                <td>Kelas</td>
                                <td id="kelas"></td>
                            </tr>
                            <tr>
                                <td>Ordo</td>
                                <td id="ordo"></td>
                            </tr>
                            <tr>
                                <td>Famili</td>
                                <td id="famili"></td>
                            </tr>
                            <tr>
                                <td>Genus</td>
                                <td id="genus"></td>
                            </tr>
                            <tr>
                                <td>Spesies</td>
                                <td id="spesies"></td>
                            </tr>
                            <tr>
                                <td>Ukuran</td>
                                <td id="ukuran"></td>
                            </tr>
                            <tr>
                                <td>Hasil Identifikasi</td>
                                <td id="identifikasi"></td>
                            </tr>
                            <tr>
                                <td>Confident</td>
                                <td id="confident"></td>
                            </tr>
                            <tr>
                                <td>Habitat</td>
                                <td id="habitat" colspan="2"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
      <!-- /.container-fluid -->
    </div>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->

  <!-- Main Footer -->
  <footer class="main-footer">
    <strong>Copyright &copy; 2020 Informatika Universitas Bengkulu.</strong>
    All rights reserved.
    <div class="float-right d-none d-sm-inline-block">
      <b>Version</b> 3.0.0-rc.5
    </div>
  </footer>
</div>
<!-- ./wrapper -->

<!-- REQUIRED SCRIPTS -->

<!-- jQuery -->
<script src="static/plugins/jquery/jquery.min.js"></script>
<!-- Bootstrap -->
<script src="static/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- AdminLTE -->
<script src="static/dist/js/adminlte.js"></script>

<!-- OPTIONAL SCRIPTS -->
<script src="/static/js/tf.min.js"></script>
<script src="/static/js/jquery.js"></script>
<script src="/static/js/bootstrap.min.js"></script>
<script src="/static/js/db.js?3"></script>
<script>
    async function loadModel() {
        var model = await tf.loadLayersModel('/static/model/model.json?3');
        return model;
    }

    $(document).ready(function() {
        $(".output").hide();
        loadModel().then(model => {
            $(".se-pre-con").fadeOut("slow");
            let image_features = JSON.parse($("#image-features").val());
            let contrast = 0;
            let correlation = 0;
            let energy = 0;
            let homogeneity = 0;
            for(let i = 0; i<4; i++) {
                contrast += image_features[i];
                correlation += image_features[i+4];
                energy += image_features[i+8];
                homogeneity += image_features[i+12];
            }
            contrast /= 4;
            correlation /= 4;
            energy /= 4;
            homogeneity /= 4;

            let xs = tf.tensor2d(image_features, [1, 16]);
            let prediction = model.predict(xs);
            prediction.print();
            

            let labels = ['Nanas Dewasa',
                            'Tempurung Datar',
                            'Nanas Muda',
                            'Baning Coklat',
                            'Pipi Putih',
                            'Batok',
                            'Garis Hitam',
                            'Biuku'];
            // let labelIndex = [9, 3, 8, 4, 5, 2, 1, 6];
            let labelIndex = [4, 2, 6, 1, 9, 8, 5, 3]
            let predictIndex = prediction.argMax(1).arraySync();
            //console.log(predictIndex);
            let confident = prediction.arraySync()[0][predictIndex];
            let label = labelIndex[predictIndex];
            if(confident < 0.3) {
                label = 7;
            }
            let dict = database[label];

            d = new Date();
            $("#clean").attr("src", "/static/uploads/clean.jpg?"+d.getTime());
            $("#glcm").attr("src", "/static/uploads/glcm.jpg?"+d.getTime());
            // $("#his").attr("src", "/static/uploads/his.jpg?"+d.getTime());
            $("#source").attr("src", "/static/uploads/image.jpg?"+d.getTime());

            $("#contrast").html(contrast);
            $("#correlation").html(correlation);
            $("#energy").html(energy);
            $("#homogeneity").html(homogeneity);

            // $("#mean-h").html(image_features[16]);
            // $("#mean-i").html(image_features[17]);
            // $("#mean-s").html(image_features[18]);
            // $("#std-h").html(image_features[19]);
            // $("#std-i").html(image_features[20]);
            // $("#std-s").html(image_features[21]);

            for(let key in dict) {
                if(key == 'id') continue;
                $("#"+key).html(dict[key]);
            }
            
            $("#confident").html(confident);

            $(".output").show();
            $(".se-pre-con").fadeOut("slow");
        });
    });
</script>
</body>
</html>
